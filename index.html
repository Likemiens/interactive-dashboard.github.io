<!DOCTYPE html>
<html lang="ru" class="h-full">
<head>
  <meta charset="UTF-8" />
  <title>–ò–Ω—Ñ–æ–≥—Ä–∞—Ñ–∏–∫–∞ ‚Äî —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ (–¥–µ–º–æ)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { color-scheme: dark light; }
    html { font-feature-settings: "ss01" on, "ss02" on; }
    .card { border-radius: 16px; background: #0f172a; border: 1px solid rgba(148,163,184,.12); box-shadow: 0 10px 30px rgba(2,6,23,.25); }
    .soft { backdrop-filter: blur(6px); background: linear-gradient(180deg, rgba(148,163,184,.06), rgba(148,163,184,.03)); border: 1px solid rgba(148,163,184,.12); }
    .kpi { background: linear-gradient(135deg, rgba(14,165,233,.14), rgba(45,202,115,.14)); }
  </style>
  <!-- Chart.js + datalabels -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
</head>
<body class="h-full bg-slate-900 text-slate-100 selection:bg-sky-500/30">
  <div class="max-w-7xl mx-auto p-6 md:p-10 space-y-8">

    <header class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
      <div class="flex items-center gap-3">
        <div class="h-10 w-10 rounded-xl bg-gradient-to-br from-sky-500 to-emerald-500"></div>
        <div>
          <h1 class="text-2xl md:text-3xl font-bold">–ò–Ω—Ñ–æ–≥—Ä–∞—Ñ–∏–∫–∞ ‚Äî –¥–µ–º–æ –¥–∞—à–±–æ—Ä–¥–∞</h1>
          <p class="text-sm text-slate-400">–§–µ–π–∫–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã –ø–æ 5 –≤–æ–ø—Ä–æ—Å–∞–º + 2 —Å–≤–æ–¥–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–∞. –í—Å–µ–≥–æ: <span id="kpi-total" class="text-slate-200 font-semibold">60</span> —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.</p>
        </div>
      </div>
      <div class="text-xs text-slate-400">–î–µ–º–æ-–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è ‚Ä¢ Tailwind + Chart.js</div>
    </header>

    <section class="grid sm:grid-cols-3 gap-4">
      <div class="card p-4 kpi">
        <div class="text-xs uppercase tracking-wide text-slate-300">–ò–º–ø–æ—Ä—Ç–æ–∑–∞–º–µ—â–µ–Ω–∏–µ ‚Äî –î–∞</div>
        <div id="kpi-yes" class="text-3xl font-semibold mt-1">‚Äî</div>
        <div class="text-xs text-slate-400 mt-1">–î–æ–ª—è –æ—Ç –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ Q2</div>
      </div>
      <div class="card p-4">
        <div class="text-xs uppercase tracking-wide text-slate-300">–°—Ä–µ–¥–Ω–∏–π —Å—Ä–æ–∫</div>
        <div id="kpi-avg" class="text-3xl font-semibold mt-1">‚Äî</div>
        <div class="text-xs text-slate-400 mt-1">–ü–æ Q3 (–≥–æ–¥—ã, –±–µ–∑ ¬´–Ω–µ –±—É–¥–µ–º¬ª)</div>
      </div>
      <div class="card p-4">
        <div class="text-xs uppercase tracking-wide text-slate-300">–ë—é–¥–∂–µ—Ç &gt; 1 –º–ª—Ä–¥</div>
        <div id="kpi-gt1" class="text-3xl font-semibold mt-1">‚Äî</div>
        <div class="text-xs text-slate-400 mt-1">–ü–æ Q4</div>
      </div>
    </section>

    <section class="grid lg:grid-cols-2 gap-6">
      <div class="card p-4">
        <div class="flex items-center justify-between mb-2">
          <h2 class="font-semibold">1) –†–æ–ª—å –≤ –∫–æ–º–ø–∞–Ω–∏–∏</h2>
          <span class="text-xs text-slate-400">–ö—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞</span>
        </div>
        <div class="h-[340px]"><canvas id="q1"></canvas></div>
      </div>

      <div class="card p-4">
        <div class="flex items-center justify-between mb-2">
          <h2 class="font-semibold">2) –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ª–∏ –∏–º–ø–æ—Ä—Ç–æ–∑–∞–º–µ—â–µ–Ω–∏–µ?</h2>
          <span class="text-xs text-slate-400">–°—Ç–æ–ª–±–∏–∫–∏ —Å –ø—Ä–æ—Ü–µ–Ω—Ç–∞–º–∏</span>
        </div>
        <div class="h-[340px]"><canvas id="q2"></canvas></div>
      </div>

      <div class="card p-4">
        <div class="flex items-center justify-between mb-2">
          <h2 class="font-semibold">3) –°—Ä–æ–∫–∏ –∏–º–ø–æ—Ä—Ç–æ–∑–∞–º–µ—â–µ–Ω–∏—è</h2>
          <span class="text-xs text-slate-400">–°—Ç–æ–ª–±–∏–∫–∏</span>
        </div>
        <div class="h-[340px]"><canvas id="q3"></canvas></div>
      </div>

      <div class="card p-4">
        <div class="flex items-center justify-between mb-2">
          <h2 class="font-semibold">4) –ú–æ–∂–µ—Ç –ª–∏ —Å—Ç–æ–∏—Ç—å &gt; 1 —É—Å–ª. –µ–¥.?</h2>
          <span class="text-xs text-slate-400">–°—Ç–æ–ª–±–∏–∫–∏</span>
        </div>
        <div class="h-[340px]"><canvas id="q4"></canvas></div>
      </div>
    </section>

    <section class="grid lg:grid-cols-2 gap-6">
      <div class="card p-4">
        <div class="flex items-center justify-between mb-2">
          <h2 class="font-semibold">–°–≤–æ–¥–Ω—ã–π 1: Q2 √ó Q3</h2>
        </div>
        <div class="h-[360px]"><canvas id="cross1"></canvas></div>
      </div>

      <div class="card p-4">
        <div class="flex items-center justify-between mb-2">
          <h2 class="font-semibold">–°–≤–æ–¥–Ω—ã–π 2: Q3 √ó Q4</h2>
        </div>
        <div class="h-[360px]"><canvas id="cross2"></canvas></div>
      </div>
    </section>

    <section class="card p-4">
      <h2 class="font-semibold mb-3">5) –û—Ç–∫—Ä—ã—Ç—ã–µ –æ—Ç–≤–µ—Ç—ã (–ø–æ–¥–±–æ—Ä–∫–∞ —Ç–µ–º)</h2>
      <div id="chips" class="flex flex-wrap gap-2"></div>
      <ul id="open" class="mt-4 grid md:grid-cols-2 gap-2"></ul>
    </section>
  </div>

  <script>
    // ----- –§–ï–ô–ö-–î–ê–ù–ù–´–ï -----
    const dataQ1 = [
      { label: "–ò–¢-–¥–∏—Ä–µ–∫—Ç–æ—Ä", value: 21 },
      { label: "–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π –¥–∏—Ä–µ–∫—Ç–æ—Ä", value: 18 },
      { label: "–û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –¥–∏—Ä–µ–∫—Ç–æ—Ä", value: 15 },
      { label: "–î—Ä—É–≥–æ–µ", value: 6 },
    ];
    const dataQ2 = [
      { label: "–î–∞", value: 35 },
      { label: "–ù–µ—Ç", value: 10 },
      { label: "–ù–µ –∑–Ω–∞—é", value: 15 },
    ];
    const dataQ3 = [
      { label: "–ì–æ–¥", value: 20 },
      { label: "–î–≤–∞", value: 18 },
      { label: "–¢—Ä–∏", value: 10 },
      { label: "–ß–µ—Ç—ã—Ä–µ", value: 6 },
      { label: "–ù–µ –±—É–¥–µ–º –Ω–∏—á–µ–≥–æ –¥–µ–ª–∞—Ç—å", value: 6 },
    ];
    const dataQ4 = [
      { label: "–î–∞", value: 32 },
      { label: "–ù–µ—Ç", value: 28 },
    ];
    const dataQ5 = [
      "–î–µ—Ñ–∏—Ü–∏—Ç —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤",
      "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —É–Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–Ω—ã–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏",
      "–ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å",
      "–ë—é–¥–∂–µ—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è",
      "–°—Ä–æ–∫–∏ –∑–∞–∫—É–ø–æ–∫ –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–π",
      "–û–±—É—á–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞ –∏ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º",
      "–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤",
      "–†–∏—Å–∫–∏ –ø—Ä–æ—Å—Ç–æ—è –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏",
      "–ö–∞—á–µ—Å—Ç–≤–æ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —É –≤–µ–Ω–¥–æ—Ä–æ–≤",
    ];
    const crossQ2Q3 = {
      "–î–∞":      { "–ì–æ–¥": 12, "–î–≤–∞": 11, "–¢—Ä–∏": 6, "–ß–µ—Ç—ã—Ä–µ": 3, "–ù–µ –±—É–¥–µ–º –Ω–∏—á–µ–≥–æ –¥–µ–ª–∞—Ç—å": 3 },
      "–ù–µ—Ç":     { "–ì–æ–¥": 3,  "–î–≤–∞": 3,  "–¢—Ä–∏": 2, "–ß–µ—Ç—ã—Ä–µ": 1, "–ù–µ –±—É–¥–µ–º –Ω–∏—á–µ–≥–æ –¥–µ–ª–∞—Ç—å": 1 },
      "–ù–µ –∑–Ω–∞—é": { "–ì–æ–¥": 5,  "–î–≤–∞": 4,  "–¢—Ä–∏": 2, "–ß–µ—Ç—ã—Ä–µ": 2, "–ù–µ –±—É–¥–µ–º –Ω–∏—á–µ–≥–æ –¥–µ–ª–∞—Ç—å": 2 },
    };
    const crossQ3Q4 = {
      "–ì–æ–¥": { "–î–∞": 11, "–ù–µ—Ç": 9 },
      "–î–≤–∞": { "–î–∞": 10, "–ù–µ—Ç": 8 },
      "–¢—Ä–∏": { "–î–∞": 6,  "–ù–µ—Ç": 4 },
      "–ß–µ—Ç—ã—Ä–µ": { "–î–∞": 3, "–ù–µ—Ç": 3 },
      "–ù–µ –±—É–¥–µ–º –Ω–∏—á–µ–≥–æ –¥–µ–ª–∞—Ç—å": { "–î–∞": 2, "–ù–µ—Ç": 4 },
    };
    const TOTAL = 60;

    // ----- –¶–í–ï–¢–ê –ò –ü–û–ú–û–©–ù–ò–ö–ò -----
    const palette = {
      sky:   ["#38bdf8", "#0ea5e9"],
      green: ["#34d399", "#10b981"],
      amber: ["#fbbf24", "#f59e0b"],
      violet:["#c084fc", "#a78bfa"],
      slate: ["#94a3b8", "#64748b"],
      red:   ["#f87171", "#ef4444"],
    };
    function gradient(ctx, c1, c2) {
      const h = ctx.canvas.height || 300;
      const g = ctx.createLinearGradient(0, h, 0, 0);
      g.addColorStop(0, c1);
      g.addColorStop(1, c2);
      return g;
    }
    function percent(v, total) { return total ? Math.round((v/total)*100) : 0; }

    // KPI
    document.getElementById("kpi-total").textContent = TOTAL.toString();
    const yes = dataQ2.find(d => d.label === "–î–∞").value;
    const gt1 = dataQ4.find(d => d.label === "–î–∞").value;
    const avgYears = (() => {
      const map = { "–ì–æ–¥":1, "–î–≤–∞":2, "–¢—Ä–∏":3, "–ß–µ—Ç—ã—Ä–µ":4 };
      const usable = dataQ3.filter(d => d.label in map);
      const sum = usable.reduce((a,d)=> a + map[d.label]*d.value, 0);
      const count = usable.reduce((a,d)=> a + d.value, 0);
      return (sum / Math.max(1,count)).toFixed(1);
    })();
    document.getElementById("kpi-yes").textContent = `${yes} (${percent(yes, dataQ2.reduce((a,b)=>a+b.value,0))}%)`;
    document.getElementById("kpi-gt1").textContent = `${gt1} (${percent(gt1, dataQ4.reduce((a,b)=>a+b.value,0))}%)`;
    document.getElementById("kpi-avg").textContent = `${avgYears} –≥–æ–¥–∞`;

    // Chart.js
    Chart.register(ChartDataLabels);
    const common = {
      plugins: {
        legend: { labels: { color: "#cbd5e1", boxWidth: 12 } },
        tooltip: {
          backgroundColor: "rgba(2,6,23,0.9)",
          titleColor: "#e2e8f0",
          bodyColor: "#e2e8f0",
          borderColor: "rgba(148,163,184,.2)",
          borderWidth: 1,
          callbacks: {
            label: (ctx) => {
              const val = ctx.parsed.y ?? ctx.parsed;
              const t = ctx.chart.config.data.__total ?? TOTAL;
              return ` ${val} —á–µ–ª. (${percent(val, t)}%)`;
            }
          }
        },
        datalabels: {
          color: "#cbd5e1",
          font: { weight: "600", size: 11 },
          formatter: (v, ctx) => {
            const total = ctx.chart.config.data.__total ?? TOTAL;
            const p = percent(v, total);
            return p >= 6 ? `${p}%` : "";
          }
        }
      },
      scales: {
        x: { ticks: { color: "#cbd5e1" }, grid: { color: "rgba(148,163,184,.12)" } },
        y: { ticks: { color: "#cbd5e1" }, grid: { color: "rgba(148,163,184,.12)" }, beginAtZero: true, suggestedMax: 20 }
      }
    };

    // Q1 ‚Äî Donut
    (function(){
      const c = document.getElementById("q1").getContext("2d");
      new Chart(c, {
        type: "doughnut",
        data: {
          labels: dataQ1.map(d=>d.label),
          datasets: [{
            data: dataQ1.map(d=>d.value),
            borderWidth: 0,
            hoverOffset: 6,
            backgroundColor: [
              gradient(c, ...palette.sky),
              gradient(c, ...palette.green),
              gradient(c, ...palette.amber),
              gradient(c, ...palette.violet),
            ]
          }],
          __total: dataQ1.reduce((a,b)=>a+b.value,0)
        },
        options: {
          cutout: "58%",
          plugins: {
            legend: { position: "bottom" },
            tooltip: common.plugins.tooltip,
            datalabels: {
              color: "#e2e8f0",
              formatter: (v, ctx) => `${ctx.chart.data.labels[ctx.dataIndex]}: ${v}`
            }
          }
        }
      });
    })();

    // Bars
    function makeBars(canvasId, data, colors){
      const c = document.getElementById(canvasId).getContext("2d");
      new Chart(c, {
        type: "bar",
        data: {
          labels: data.map(d=>d.label),
          datasets: [{
            data: data.map(d=>d.value),
            backgroundColor: data.map((_,i)=>gradient(c, ...colors[i%colors.length])),
            borderRadius: 10,
            borderSkipped: false
          }],
          __total: data.reduce((a,b)=>a+b.value,0)
        },
        options: JSON.parse(JSON.stringify(common))
      });
    }
    makeBars("q2", dataQ2, [palette.green, palette.red, palette.slate]);
    makeBars("q3", dataQ3, [palette.sky, palette.green, palette.amber, palette.violet, palette.slate]);
    makeBars("q4", dataQ4, [palette.green, palette.red]);

    // 100% stacked
    function makeStacked100(canvasId, categories, series, matrix, colors){
      const c = document.getElementById(canvasId).getContext("2d");
      const totals = categories.map(cat => Object.values(matrix[cat]).reduce((a,b)=>a+b,0));
      const datasets = series.map((s, i) => ({
        label: s,
        data: categories.map((cat, idx) => {
          const v = matrix[cat][s] ?? 0;
          const t = totals[idx] || 1;
          return Math.round((v/t)*100);
        }),
        backgroundColor: gradient(c, ...colors[i%colors.length]),
        borderRadius: 10,
        borderSkipped: false,
        stack: "a"
      }));
      new Chart(c, {
        type: "bar",
        data: { labels: categories, datasets, __total: 100 },
        options: {
          plugins: {
            legend: { position: "bottom", labels: { color: "#cbd5e1" } },
            tooltip: {
              backgroundColor: "rgba(2,6,23,0.9)",
              titleColor: "#e2e8f0",
              bodyColor: "#e2e8f0",
              callbacks: { label: (ctx) => ` ${ctx.dataset.label}: ${ctx.parsed.y}%` }
            },
            datalabels: {
              color: "#0ea5e9",
              font: { weight: "700", size: 10 },
              formatter: (v) => v >= 12 ? `${v}%` : ""
            }
          },
          scales: {
            x: { stacked: true, ticks: { color: "#cbd5e1" }, grid: { color: "rgba(148,163,184,.12)" } },
            y: { stacked: true, ticks: { color: "#cbd5e1", callback: (v)=> v + "%" }, grid: { color: "rgba(148,163,184,.12)" }, suggestedMax: 100, beginAtZero: true }
          }
        }
      });
    }
    makeStacked100(
      "cross1",
      ["–î–∞","–ù–µ—Ç","–ù–µ –∑–Ω–∞—é"],
      ["–ì–æ–¥","–î–≤–∞","–¢—Ä–∏","–ß–µ—Ç—ã—Ä–µ","–ù–µ –±—É–¥–µ–º –Ω–∏—á–µ–≥–æ –¥–µ–ª–∞—Ç—å"],
      crossQ2Q3,
      [palette.sky, palette.green, palette.amber, palette.violet, palette.slate]
    );
    makeStacked100(
      "cross2",
      ["–ì–æ–¥","–î–≤–∞","–¢—Ä–∏","–ß–µ—Ç—ã—Ä–µ","–ù–µ –±—É–¥–µ–º –Ω–∏—á–µ–≥–æ –¥–µ–ª–∞—Ç—å"],
      ["–î–∞","–ù–µ—Ç"],
      crossQ3Q4,
      [palette.green, palette.red]
    );

    // Q5 ‚Äî —á–∏–ø—ã + —Å–ø–∏—Å–æ–∫ (üö´ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é 'top', –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–æ)
    const freq = {};
    dataQ5.forEach(t => t.toLowerCase().split(/\s+/).forEach(w => {
      if (w.length < 4) return;
      freq[w] = (freq[w]||0)+1;
    }));
    const topWords = Object.entries(freq).sort((a,b)=>b[1]-a[1]).slice(0,8);
    const chips = document.getElementById("chips");
    topWords.forEach(([w,c]) => {
      const el = document.createElement("span");
      el.className = "soft text-xs text-slate-200 px-3 py-1 rounded-full";
      el.textContent = `${w} ¬∑ ${c}`;
      chips.appendChild(el);
    });
    const open = document.getElementById("open");
    dataQ5.forEach(t=>{
      const li = document.createElement("li");
      li.className = "soft rounded-xl p-3 text-sm";
      li.textContent = t;
      open.appendChild(li);
    });
  </script>
</body>
</html>
